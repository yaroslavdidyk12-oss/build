<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–ü–ª–∞–Ω –±–µ–∑–ø–µ–∫–∏</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2f80ed">

<style>
body{
  font-family:Arial,sans-serif;
  background:#f2f4f7;
  margin:0;
  padding:10px;
}
h1{text-align:center}

.tabs{
  display:flex;
  gap:5px;
  margin-bottom:10px;
}
.tabs button{
  flex:1;
  padding:10px;
  border:none;
  background:#ddd;
  font-size:16px;
}
.tabs button.active{
  background:#2f80ed;
  color:#fff;
}

section{
  display:none;
  background:#fff;
  padding:10px;
  border-radius:10px;
}
section.active{display:block}

table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px}
th{background:#eee}

.have{background:#d4edda}

input[type=text]{width:100%}
input[type=number]{width:60px}
button.small{padding:4px 8px}
</style>
</head>

<body>

<h1>üõ°Ô∏è –ü–ª–∞–Ω –±–µ–∑–ø–µ–∫–∏</h1>

<div class="tabs">
  <button data-tab="home">üè† –í–¥–æ–º–∞</button>
  <button data-tab="evac">üéí –ï–≤–∞–∫—É–∞—Ü—ñ—è</button>
  <button data-tab="car">üöó –ê–≤—Ç–æ</button>
</div>

<section id="home"></section>
<section id="evac"></section>
<section id="car"></section>

<script>
// ===== –î–ê–ù–Ü =====
const defaultData = {
  home: ["–í–æ–¥–∞", "–á–∂–∞", "–ê–ø—Ç–µ—á–∫–∞"],
  evac: ["–î–æ–∫—É–º–µ–Ω—Ç–∏", "–†—é–∫–∑–∞–∫", "–õ—ñ—Ö—Ç–∞—Ä–∏–∫"],
  car:  ["–ê–ø—Ç–µ—á–∫–∞ –∞–≤—Ç–æ", "–ö–æ–≤–¥—Ä–∞", "–ó–∞—Ä—è–¥–∫–∞"]
};

let data = JSON.parse(localStorage.getItem("planData")) || defaultData;

// ===== –†–ï–ù–î–ï–† =====
function renderSection(key){
  const sec = document.getElementById(key);
  sec.innerHTML = `
    <h2>${key==="home"?"üè† –í–¥–æ–º–∞":key==="evac"?"üéí –ï–≤–∞–∫—É–∞—Ü—ñ—è":"üöó –ê–≤—Ç–æ"}</h2>
    <table>
      <tr><th>–ú–∞—é</th><th>–†—ñ—á</th><th></th></tr>
      ${data[key].map((item,i)=>`
        <tr>
          <td><input type="checkbox" onchange="toggleHave(this)"></td>
          <td>${item}</td>
          <td><button class="small" onclick="removeItem('${key}',${i})">üóëÔ∏è</button></td>
        </tr>
      `).join("")}
    </table>
    <br>
    <button onclick="addItem('${key}')">‚ûï –î–æ–¥–∞—Ç–∏ —Ä—ñ—á</button>
  `;
}

function renderAll(){
  renderSection("home");
  renderSection("evac");
  renderSection("car");
}

// ===== –î–Ü–á =====
function addItem(section){
  const name = prompt("–ù–∞–∑–≤–∞ —Ä–µ—á—ñ:");
  if(!name) return;
  data[section].push(name);
  save();
  renderSection(section);
}

function removeItem(section, idx){
  data[section].splice(idx,1);
  save();
  renderSection(section);
}

function toggleHave(cb){
  cb.closest("tr").classList.toggle("have", cb.checked);
}

function save(){
  localStorage.setItem("planData", JSON.stringify(data));
}

// ===== –í–ö–õ–ê–î–ö–ò =====
const buttons = document.querySelectorAll(".tabs button");
const sections = document.querySelectorAll("section");

function showTab(tab, push=true){
  sections.forEach(s=>s.classList.remove("active"));
  buttons.forEach(b=>b.classList.remove("active"));

  document.getElementById(tab).classList.add("active");
  document.querySelector(`[data-tab="${tab}"]`).classList.add("active");

  if(push) history.pushState({tab},"","#"+tab);
}

buttons.forEach(btn=>{
  btn.addEventListener("click",()=>showTab(btn.dataset.tab));
});

window.addEventListener("popstate",e=>{
  showTab(e.state?.tab || "home", false);
});

// ===== –°–¢–ê–†–¢ =====
renderAll();
showTab(location.hash.replace("#","") || "home", false);

// ===== SW =====
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
